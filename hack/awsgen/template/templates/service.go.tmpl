package {{.Package}}

import (
    "reflect"

    "github.com/run-x/cloudgrep/pkg/provider/awsgen/registry"

    {{- range .Imports }}
    {{- if .As }}
    {{ .As }} "{{ .Path }}"
    {{- else }}
    "{{ .Path }}"
    {{- end }}
    {{- end }}
)

func register_{{.Service}}(r registry.Registry) {
    r.RegisterService({{ .Service | quote }}, []registry.TypeRegistration{
        {{- range .Types }}
        {{- $type := (cat "reflect.TypeOf(types." .Type "{})") }}
        {
            Name:     {{ .Name | quote }},
            APIType:  {{ $type }},
            IDField:  mustFieldByName({{ $type }}, {{ .ID | quote }}),
            TagField: mustFieldByName({{ $type }}, {{ .Tag | quote }}),
        },
        {{- end }}
    })
}
